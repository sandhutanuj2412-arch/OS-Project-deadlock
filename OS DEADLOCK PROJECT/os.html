<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Automated Deadlock Detection</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Automated Deadlock Detection</h1>
        <p class="lead">Enter processes, resources, set holds/waits, and detect deadlocks visually.</p>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <p class="section-title">Create Entities</p>
          <label for="procName">Process name</label>
          <div class="row" style="margin-bottom:8px">
            <input id="procName" placeholder="e.g., P1" aria-label="Process name input" />
            <button id="addProc" aria-label="Add process">Add</button>
          </div>

          <label for="resName">Resource name</label>
          <div class="row" style="margin-bottom:8px">
            <input id="resName" placeholder="e.g., R1" aria-label="Resource name input" />
            <button id="addRes" aria-label="Add resource">Add</button>
          </div>

          <p class="section-title" style="margin-top:12px">Set Hold / Wait</p>
          <label for="holdProc">Holder (process)</label>
          <select id="holdProc" aria-label="Select process that holds resource"></select>
          <label for="holdRes">Resource held</label>
          <select id="holdRes" aria-label="Select resource being held"></select>
          <div style="margin-top:8px" class="row">
            <button id="addHold" class="small" aria-label="Add hold relationship">Add Hold</button>
            <button id="clearHolds" class="small secondary" aria-label="Clear all holds">Clear Holds</button>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />

          <label for="waitProc">Waiting Process</label>
          <select id="waitProc" aria-label="Select process that is waiting"></select>
          <label for="waitRes">Resource waiting for</label>
          <select id="waitRes" aria-label="Select resource being waited for"></select>
          <div style="margin-top:8px" class="row">
            <button id="addWait" class="small" aria-label="Add wait relationship">Add Wait</button>
            <button id="clearWaits" class="small secondary" aria-label="Clear all waits">Clear Waits</button>
          </div>

          <p class="section-title" style="margin-top:12px">Quick Samples</p>
          <div style="display:flex;gap:6px;margin-bottom:8px">
            <button id="sample1" class="small secondary" aria-label="Load simple deadlock sample">Simple Deadlock</button>
            <button id="sample2" class="small secondary" aria-label="Load no deadlock sample">No Deadlock</button>
            <button id="resetAll" class="small" aria-label="Reset all data">Reset</button>
          </div>

          <p class="section-title">Lists</p>

          <div class="list" id="lists">

          </div>

        </div>
        
      </div>

      <div class="viz-wrap">
        <div class="card" style="flex:0 0 auto;padding:10px;border-radius:12px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between">
          <div style="display:flex;gap:12px;align-items:center">
            <div style="font-weight:700">Graph</div>
            <div class="legend">
              <div class="chip">● Process</div>
              <div class="chip">■ Resource</div>
              <div class="chip" style="color:var(--muted)">→ Hold (solid)</div>
              <div class="chip" style="color:var(--muted)">→ Wait (dashed)</div>
            </div>
          </div>
          <div style="display:flex;gap:8px">
            <button id="detect" class="small" aria-label="Run deadlock detection">Detect Deadlock</button>
            <button id="stepByStep" class="small secondary" aria-label="Step-by-step visualization">Step-by-Step</button>
            <button id="downloadReport" class="small secondary" aria-label="Download analysis report">Download Report</button>
          </div>
        </div>

        <div class="svg-area card" id="svgCard" role="img" aria-label="Deadlock detection graph visualization">
          <svg id="svg" viewBox="0 0 1200 700" preserveAspectRatio="xMidYMid meet" aria-hidden="true"></svg>
        </div>

        <div class="card summary" id="summary">
          <strong id="resultTitle">No analysis run yet.</strong>
          <div id="resultBody" style="margin-top:8px;color:var(--muted)">Add entities and then click <em>Detect Deadlock</em>.</div>
        </div>

        <!-- Step-by-Step Controls -->
        <div class="card" id="stepControls" style="display:none;margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <strong style="color:var(--accent)">Algorithm Visualization</strong>
            <button id="closeStepMode" class="small secondary">Close</button>
          </div>
          <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">
            <button id="prevStep" class="small secondary" disabled>◀ Previous</button>
            <button id="nextStep" class="small secondary">Next ▶</button>
            <button id="autoPlay" class="small secondary">▶ Auto Play</button>
            <button id="resetSteps" class="small secondary">Reset</button>
          </div>
          <div style="background:rgba(0,0,0,0.2);padding:12px;border-radius:8px;margin-bottom:8px">
            <div style="font-size:12px;color:var(--muted);margin-bottom:4px">Step <span id="currentStepNum">0</span> of <span id="totalSteps">0</span></div>
            <div id="stepDescription" style="font-size:13px;color:#e2e8f0;line-height:1.6"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div style="background:rgba(0,0,0,0.2);padding:10px;border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px;text-transform:uppercase">VISITED NODES</div>
              <div id="visitedNodes" style="font-size:12px;color:var(--ok);font-family:'JetBrains Mono',monospace">-</div>
            </div>
            <div style="background:rgba(0,0,0,0.2);padding:10px;border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px;text-transform:uppercase">STACK STATE</div>
              <div id="stackState" style="font-size:12px;color:var(--accent);font-family:'JetBrains Mono',monospace">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>Tip: Use the sample configurations to quickly test. Cycle edges are highlighted in red.</footer>
  </div>

  <div id="notificationContainer" role="status" aria-live="polite" aria-atomic="true"></div>

  <script src="script.js"></script>
</body>
</html>
